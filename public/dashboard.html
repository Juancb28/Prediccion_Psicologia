<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Principal - MindCare</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>

<div class="container">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-container">
            <div class="logo-icon">ğŸ§ </div>
            <h2 class="logo">MindCare</h2>
            <p class="logo-subtitle">Sistema ClÃ­nico</p>
        </div>
        <ul class="menu-list">
            <li class="menu-item active">
                <a href="/dashboard" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit;">
                    <span class="menu-icon">ğŸ“Š</span>
                    <span class="menu-text">Panel</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="/pacientes" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit;">
                    <span class="menu-icon">ğŸ‘¥</span>
                    <span class="menu-text">Pacientes</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="/agenda" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit;">
                    <span class="menu-icon">ğŸ“…</span>
                    <span class="menu-text">Agenda</span>
                </a>
            </li>
            <li class="menu-item">
                <a href="/sesiones" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: inherit;">
                    <span class="menu-icon">ğŸ’¬</span>
                    <span class="menu-text">Sesiones</span>
                </a>
            </li>
        </ul>
        <div class="sidebar-footer" onclick="window.location.href='/perfil'" style="cursor: pointer;">
            <div class="user-info">
                <div class="user-avatar">ğŸ‘¨â€âš•ï¸</div>
                <div class="user-details">
                    <div class="user-name">Dr. PsicÃ³logo</div>
                    <div class="user-status">En lÃ­nea</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="content" id="mainContent">
        <h1>Panel Principal</h1>
        <div class="dashboard-grid" id="dashboardGrid">
            <!-- El contenido se cargarÃ¡ aquÃ­ -->
        </div>
    </main>

</div>

<script>
// CÃ³digo especÃ­fico del Dashboard
(function() {
    'use strict';

    // Cargar datos desde localStorage
    function loadData() {
        const patients = JSON.parse(localStorage.getItem('pp_patients') || '[]');
        const sessions = JSON.parse(localStorage.getItem('pp_sessions') || '[]');
        const appointments = JSON.parse(localStorage.getItem('pp_agenda') || '[]');
        return { patients, sessions, appointments };
    }

    // Renderizar Dashboard
    function renderDashboard() {
        const { patients, sessions, appointments } = loadData();
        const today = new Date().toISOString().slice(0, 10);
        const citasHoy = appointments.filter(a => a.fecha === today);
        const citasPendientes = appointments.filter(a => a.estado === 'Pendiente').length;

        const dashboardHTML = `
            <div class="card dashboard-calendar-card">
                <div class="calendar-card-header">
                    <h3>ğŸ“… Calendario del Mes</h3>
                    <button class="calendar-today-btn" onclick="window.location.reload()">
                        <span>ğŸ“…</span>
                        <span>Hoy</span>
                    </button>
                </div>
                ${renderCalendar(appointments)}
            </div>

            <div class="card dashboard-appointments-card">
                <div class="dashboard-card-header">
                    <h3>ğŸ• PrÃ³ximas citas del dÃ­a</h3>
                    <span class="appointments-badge">${citasHoy.length}</span>
                </div>
                <div class="appointments-today-list">
                    ${citasHoy.length ? citasHoy.map(c => {
                        const p = patients.find(x => x.id === c.pacienteId);
                        const statusClass = c.estado === 'Confirmada' ? 'confirmed' : 
                                           c.estado === 'Pendiente' ? 'pending' : 
                                           c.estado === 'Finalizada' ? 'finished' : 'cancelled';
                        return `
                            <div class="today-appointment-item ${statusClass}">
                                <div class="appointment-time-badge">
                                    <span>ğŸ•</span>
                                    <span>${c.hora}</span>
                                </div>
                                <div class="appointment-patient-info">
                                    <span class="patient-name-today">${p ? p.nombre : 'â€”'}</span>
                                    <span class="appointment-status-mini status-${statusClass}">${c.estado}</span>
                                </div>
                            </div>
                        `;
                    }).join('') : '<div class="empty-appointments">ğŸ“­ No hay citas programadas para hoy</div>'}
                </div>
            </div>

            <div class="card dashboard-alerts-card">
                <div class="dashboard-card-header">
                    <h3>âš ï¸ Alertas</h3>
                    ${citasPendientes > 0 ? `<span class="alert-count">${citasPendientes}</span>` : ''}
                </div>
                <div class="alerts-list">
                    ${citasPendientes > 0 ? `
                        <div class="alert-item warning">
                            <div class="alert-icon">âš ï¸</div>
                            <div class="alert-content">
                                <span class="alert-title">Citas pendientes</span>
                                <span class="alert-text">Tienes ${citasPendientes} cita${citasPendientes > 1 ? 's' : ''} pendiente${citasPendientes > 1 ? 's' : ''} por confirmar</span>
                            </div>
                        </div>
                    ` : `
                        <div class="alert-item success">
                            <div class="alert-icon">âœ…</div>
                            <div class="alert-content">
                                <span class="alert-title">Todo en orden</span>
                                <span class="alert-text">No hay alertas pendientes</span>
                            </div>
                        </div>
                    `}
                </div>
            </div>

            <div class="card dashboard-quick-actions-card">
                <div class="dashboard-card-header">
                    <h3>âš¡ Acceso rÃ¡pido</h3>
                </div>
                <div class="quick-actions-grid">
                    <button class="quick-action-btn" onclick="window.location.href='/sesiones'">
                        <span class="action-icon">ğŸ“</span>
                        <span class="action-label">Registrar sesiÃ³n</span>
                    </button>
                    <button class="quick-action-btn" onclick="window.location.href='/pacientes'">
                        <span class="action-icon">ğŸ‘¥</span>
                        <span class="action-label">Ver pacientes</span>
                    </button>
                    <button class="quick-action-btn" onclick="window.location.href='/agenda'">
                        <span class="action-icon">ğŸ“…</span>
                        <span class="action-label">Crear cita</span>
                    </button>
                    <button class="quick-action-btn" onclick="window.location.href='/sesiones'">
                        <span class="action-icon">ğŸ“‹</span>
                        <span class="action-label">Historial clÃ­nico</span>
                    </button>
                </div>
            </div>

            <div class="card dashboard-summary-card">
                <div class="dashboard-card-header">
                    <h3>ğŸ“Š Resumen</h3>
                </div>
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-content">
                            <span class="stat-value">${patients.length}</span>
                            <span class="stat-label">Pacientes</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ’¼</div>
                        <div class="stat-content">
                            <span class="stat-value">${sessions.length}</span>
                            <span class="stat-label">Sesiones</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ“…</div>
                        <div class="stat-content">
                            <span class="stat-value">${appointments.length}</span>
                            <span class="stat-label">Citas totales</span>
                        </div>
                    </div>
                </div>
            </div>
        `;

        document.getElementById('dashboardGrid').innerHTML = dashboardHTML;
    }

    // Renderizar calendario
    function renderCalendar(appointments) {
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth();
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const totalDays = lastDay.getDate();
        const startDayOfWeek = firstDay.getDay();
        
        const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                           'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        
        let html = `
            <div class="calendar-header">
                <h2 class="calendar-month-title">${monthNames[month]} ${year}</h2>
            </div>
            <div class="calendar-grid">
                <div class="calendar-day-header">Dom</div>
                <div class="calendar-day-header">Lun</div>
                <div class="calendar-day-header">Mar</div>
                <div class="calendar-day-header">MiÃ©</div>
                <div class="calendar-day-header">Jue</div>
                <div class="calendar-day-header">Vie</div>
                <div class="calendar-day-header">SÃ¡b</div>
        `;
        
        for (let i = 0; i < startDayOfWeek; i++) {
            html += `<div class="calendar-day empty"></div>`;
        }
        
        for (let day = 1; day <= totalDays; day++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const dayAppointments = appointments.filter(a => a.fecha === dateStr);
            const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
            
            html += `
                <div class="calendar-day ${isToday ? 'today' : ''} ${dayAppointments.length > 0 ? 'has-appointments' : ''}">
                    <div class="day-number">${day}</div>
                    <div class="appointments">
                        ${dayAppointments.slice(0, 2).map(apt => {
                            return `<div class="appointment-badge">${apt.hora}</div>`;
                        }).join('')}
                        ${dayAppointments.length > 2 ? `<div class="more-appointments">+${dayAppointments.length - 2}</div>` : ''}
                    </div>
                </div>
            `;
        }
        
        html += `</div>`;
        return html;
    }

    // Inicializar cuando la pÃ¡gina cargue
    document.addEventListener('DOMContentLoaded', renderDashboard);
})();
</script>

</body>
</html>
